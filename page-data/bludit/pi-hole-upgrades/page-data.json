{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/bludit/pi-hole-upgrades",
    "result": {"data":{"allBluditPages":{"edges":[{"node":{"title":"Pi-hole Upgrades","content":"<p>I recently stumbled across a nice <a href=\"https://pi-hole.net/\">Pi-hole</a> setup that provides a quick and easy way to deploy Pi-hole along with a <a href=\"https://grafana.com/\">Grafana</a> dashboard to collect metrics on your network.</p>\n<p>The project is simply called <a href=\"https://github.com/geerlingguy/internet-pi\">Internet Pi</a>. </p>\n<p>The instructions provided with the project worked without any issues. Now I have Pi-hole setup on a Pi 4 and also have a nice dashboard to keep up with my network speeds.</p>\n<p>I have also been playing with <a href=\"https://tailscale.com/\">Tailscale</a>, which is a zero config VPN. I thought it would be super cool if I could set things up so that when I am connected to my Tailscale network I could also take advantage of the Pi-hole ad blocking.</p>\n<p>After a bit of research I was able to get it all working.</p>\n<p>Once I had Pi-hole setup I installed Tailscale to the Raspberry Pi running Pi-hole using their simple <a href=\"https://tailscale.com/download\">install command</a>.</p>\n<p>After install I started up Tailscale with this command.</p>\n<pre><code>sudo tailscale up --advertise-routes=192.168.1.0/24 --accept-dns=false</code></pre>\n<p><strong>Note:</strong> You will need to change the command to match your networks subnet.</p>\n<p>After I started Tailscale up I got an error referring to <a href=\"https://tailscale.com/kb/1019/subnets/#setting-up-a-subnet-router\">IP forwarding</a>. I had to run the following commands to clear that up.</p>\n<pre><code>echo 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.conf\necho 'net.ipv6.conf.all.forwarding = 1' | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p /etc/sysctl.conf</code></pre>\n<p>Then I logged into Tailscale and clicked the &quot;three dots&quot; menu next to the Machine entry for my Pi-hole. I selected &quot;Disable key expiry&quot; from the drop-down. Since the Pi-hole is not directly exposed to the internet it is safe to not require re-authentication. Then I selected &quot;Edit route settings...&quot; from the same drop-down menu and enabled the first option. See image below.</p>\n<div class=\"centered\">\n    <img src=\"/bl-content/uploads/pages/fcdb80d303d1fe7901dd6d939ebe87c3/tailscale-settings-route-updated-new.png\" class=\"image-border\" /><br><br>\n</div>\n<p>Next I copied the Tailscale IP address for my Pi-hole and used it as the Nameserver on the DNS tab. I set it to override local DNS. See image below.</p>\n<div class=\"centered\">\n    <img src=\"/bl-content/uploads/pages/fcdb80d303d1fe7901dd6d939ebe87c3/tailscale-dns.png\" class=\"image-border\" /><br><br>\n</div>\n<p>I also turned on MagicDNS on the DNS tab so that my servers would be accessible via their hostnames when on the Tailscale network. This way the Pi-hole interface would work when I am on or off the Tailscale network when I use the Pi-hole's hostname.</p>\n<p>Now I have a Tailscale VPN setup that uses my Pi-hole. </p>\n<p>I installed the Tailscale Android app so now when I am away from my home network I can still access my servers as well as be protected from ads using my Pi-hole.</p>\n<p>I also like to use <a href=\"https://github.com/pi-hole/PADD\">PADD</a> to display my Pi-hole status on a monitor in my office. However, I noticed that it wouldn't work with this new setup. After a bit more research I found the answer. </p>\n<p>On the Pi-hole I ran the following to setup PADD.</p>\n<pre><code>mkdir -p /home/pi/padd &amp;&amp; cd padd &amp;&amp; wget -N https://raw.githubusercontent.com/pi-hole/PADD/master/padd.sh &amp;&amp; chmod +x padd.sh</code></pre>\n<p>Now that I had PADD setup I needed to update my Pi-hole configuration to use it.</p>\n<p>I had to add the following volume to the <code>pi-hole-docker-compose.yml.j2</code> file which is located at <code>/home/pi/internet-pi/templates/</code>.</p>\n<pre><code>- '${HOME}/padd:/padd'</code></pre>\n<p>I then ran the following command from inside the <code>internet-pi</code> directory per the project's instructions.</p>\n<pre><code>ansible-playbook main.yml</code></pre>\n<p>Next I added the following alias to my <code>.bash_aliases</code> file in the Pi-hole home directory.</p>\n<pre><code>alias padd=\"docker exec -it pihole bash /padd/padd.sh\"</code></pre>\n<p>Now I can use the <code>padd</code> command to startup PADD.</p>\n<p><strong>Updates:</strong></p>\n<blockquote>\n<p><em>I originally had Tailscale setup to use Pi-hole as an Exit Node. I found that I was having issues resolving hostnames. I have updated the setup to not use the Pi-hole as the Exit Node. I still get the ad-blocking, and now the hostname resolution issues have been resolved.</em></p>\n<p><em>I started having odd issues where the internet speeds from the Pi 4 running Pi-hole would drop off significantly around 2am everyday. I have since moved back to Pi-hole's default installation.</em></p>\n<p>*Check out my new dual Pi-hole + Tailscale setup <a href=\"dual-pi-hole-tailscale\">here</a>.</p>\n</blockquote>"}}]}},"pageContext":{"slug":"pi-hole-upgrades"}},
    "staticQueryHashes": []}